<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HEL IROMA • Product Range Overview — PP‑R Pipes</title>
  <style>
    :root{
      --bg:#f5f7f6;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:#e5e7eb;
      --accent:#16a34a;
      --shadow: 0 18px 35px rgba(2,6,23,.10);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:linear-gradient(180deg,#eff6f3 0%, var(--bg) 40%, #f7faf8 100%);
    }
    header{
      position:sticky; top:0;
      z-index:10;
      backdrop-filter:saturate(1.2) blur(10px);
      background:rgba(245,247,246,.75);
      border-bottom:1px solid rgba(229,231,235,.7);
    }
    .topbar{
      max-width:1180px;
      margin:0 auto;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:.2px;
    }
    .badge{
      font-size:12px;
      color:var(--muted);
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:#fff;
    }
    main{
      max-width:1180px;
      margin:0 auto;
      padding:18px 16px 48px;
    }
    .grid{
      display:grid;
      /* Layout: 1 coluna / 2 linhas (mapa em cima, tabela em baixo) */
      grid-template-columns: 1fr;
      gap:16px;
      align-items:start;
    }
    .card{
      background:var(--card);
      border:1px solid rgba(229,231,235,.9);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    /* Permite que o callout/tooltip ultrapasse o card sem ser cortado (desktop / notebook / mobile). */
    .card--map{overflow:visible;}
    .cardPad{padding:16px}
    h1{
      margin:0 0 6px;
      font-size:28px;
      line-height:1.1;
      letter-spacing:-.3px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:14px;
    }
    .hint{
      margin:12px 0 0;
      padding:10px 12px;
      border:1px solid rgba(229,231,235,.9);
      background:#fbfbfb;
      border-radius:12px;
      color:#334155;
      font-size:13px;
    }

    /* MAP */
    .mapWrap{
      position:relative;
      width:100%;
      aspect-ratio: 1/1;
      background:#fff;
      border:1px solid rgba(229,231,235,.7);
      border-radius:16px;
      overflow:visible;
    }
    .svgHost{position:absolute; inset:0; width:100%; height:100%;}
    .svgHost svg{width:100%; height:100%; display:block;}
    .callout{
      position:absolute;
      min-width:240px;
      max-width:320px;
      background:#fff;
      border:1px solid rgba(229,231,235,.95);
      border-radius:14px;
      box-shadow:0 18px 30px rgba(2,6,23,.14);
      padding:12px 12px 10px;
      transform:translate(-50%, -50%);
      pointer-events:none;
      opacity:0;
      transition:opacity .12s ease, transform .12s ease;
    }
    .callout.show{opacity:1; transform:translate(-50%,-55%);}
    .callTitle{font-weight:900; letter-spacing:.2px;}
    .callRef{margin-top:4px; font-size:13px; color:#334155; font-weight:700;}
    .chips{display:flex; flex-wrap:wrap; gap:6px; margin-top:10px;}
    .chip{
      font-size:12px; font-weight:700;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(229,231,235,.9);
      background:#f8fafc;
      color:#334155;
    }
    .callLine{
      position:absolute; inset:0;
      width:100%; height:100%;
      pointer-events:none;
    }
    .callLine line{stroke:rgba(15,23,42,.75); stroke-width:2.2;}
    .callLine circle{fill:rgba(15,23,42,.8);}

    /* Hover (Shadow + Glow) por segmento */
    .svgHost .seg{cursor:pointer; transform-origin: 500px 500px;}
    .svgHost .seg:hover,
    .svgHost .seg.active{
      filter: drop-shadow(0 14px 18px rgba(0,0,0,.18)) drop-shadow(0 0 16px rgba(22,163,74,.55));
    }

    /* SELECTION / TABLE */
    .selHead{display:flex; align-items:baseline; justify-content:space-between; gap:12px;}
    .selTitle{margin:0; font-size:18px;}
    .selMeta{color:var(--muted); font-size:13px;}
    .selectedName{
      font-weight:900;
      margin:10px 0 2px;
    }
    .selectedRef{
      color:#334155;
      font-weight:700;
      font-size:13px;
      margin:0 0 10px;
    }
    .tableWrap{
      overflow:auto;
      border:1px solid rgba(229,231,235,.95);
      border-radius:12px;
      background:#fff;
    }
    table{
      width:100%;
      border-collapse:collapse;
      min-width:720px;
      font-size:13px;
    }
    th,td{
      padding:10px 10px;
      border-bottom:1px solid rgba(229,231,235,.9);
      border-right:1px solid rgba(229,231,235,.6);
      text-align:center;
      white-space:nowrap;
    }
    th:first-child, td:first-child{
      text-align:left;
      font-weight:900;
      background:#fafafa;
      position:sticky; left:0;
      z-index:1;
    }
    tr:last-child td{border-bottom:none;}
    th:last-child, td:last-child{border-right:none;}
    .legendRow{
      display:flex; gap:14px; align-items:center;
      margin-top:10px;
      color:#334155;
      font-size:13px;
      flex-wrap:wrap;
    }
    .dot{
      width:16px; height:16px; border-radius:999px;
      border:2px solid #0f172a;
      display:inline-flex; align-items:center; justify-content:center;
      font-size:11px; font-weight:900;
    }
    .btnRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;}
    .btn{
      appearance:none;
      border:1px solid rgba(229,231,235,.95);
      background:#fff;
      border-radius:12px;
      padding:10px 12px;
      font-weight:800;
      cursor:pointer;
    }
    .btn:hover{box-shadow:0 12px 24px rgba(2,6,23,.10);}
    .note{
      margin:12px 0 0;
      color:var(--muted);
      font-size:13px;
    }

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
      h1{font-size:24px;}
      .callout{max-width:300px;}
    }
  </style>
</head>
<body>
<header>
  <div class="topbar">
    <div class="brand">
      <span style="display:inline-flex; width:28px; height:28px; border-radius:10px; background:#e7f7ee; border:1px solid rgba(22,163,74,.25); align-items:center; justify-content:center; font-weight:900; color:var(--accent);">H</span>
      <div>
        <div style="font-size:14px; line-height:1.1;">HELIROMA • Product range overview</div>
        <div style="font-size:12px; color:var(--muted);">Interactive selector (SVG)</div>
      </div>
    </div>
    <span class="badge">Offline • build 2026‑01‑21</span>
  </div>
</header>

<main>
  <div class="grid">
      <section class="card card--map">
      <div class="cardPad">
        <h1>Product Range Overview — PP‑R Pipes</h1>
        <p class="sub">Passe o mouse (ou toque) sobre cada segmento. Clique para fixar a seleção. “Limpar” para desfazer.</p>
        <div class="hint">
          Pré‑requisito: o arquivo <span style="font-family:var(--mono)">mapa_produto_interativo.svg</span> deve estar no mesmo diretório deste HTML (GitHub Pages: mesma pasta).
        </div>
      </div>

      <div class="cardPad" style="padding-top:0;">
        <div class="mapWrap" id="mapWrap" aria-label="Mapa interativo">
          <div class="svgHost" id="svgHost"></div>

          <svg class="callLine" viewBox="0 0 1000 1000" preserveAspectRatio="none" aria-hidden="true">
            <line id="callLine" x1="500" y1="500" x2="500" y2="500"></line>
            <circle id="callDot" cx="500" cy="500" r="6"></circle>
          </svg>

          <div class="callout" id="callout">
            <div class="callTitle" id="callTitle">—</div>
            <div class="callRef" id="callRef">—</div>
            <div class="chips" id="callChips"></div>
          </div>
        </div>

        <p class="note">
          Nota: a tabela de diâmetros abaixo é um template. Se você fornecer a matriz completa (✓/○) do catálogo, eu atualizo para ficar 100% idêntica.
        </p>
      </div>
    </section>

    <aside class="card">
      <div class="cardPad">
        <div class="selHead">
          <h2 class="selTitle">Seleção</h2>
          <div class="selMeta" id="selMeta">Nenhum tubo selecionado</div>
        </div>

        <div class="selectedName" id="selName">—</div>
        <p class="selectedRef" id="selRef">Passe o mouse sobre um segmento para ver detalhes e a tabela de diâmetros.</p>

        <div class="tableWrap">
          <table id="diamTable" aria-label="Tabela de diâmetros">
            <thead id="diamHead"></thead>
            <tbody id="diamBody"></tbody>
          </table>
        </div>

        <div class="legendRow">
          <span><span class="dot">✓</span> Produto standard</span>
          <span><span class="dot">○</span> Disponível sob encomenda</span>
          <span><span class="dot" style="border-color:#94a3b8; color:#94a3b8;">–</span> Não aplicável</span>
        </div>

        <div class="btnRow">
          <button class="btn" id="clearBtn">Limpar seleção</button>
        </div>
      </div>
    </aside>
  </div>
</main>

<script>
(() => {
  // --- DIÂMETROS (colunas) ---
  const DIAMS = [20,25,32,40,50,63,75,90,110,125,160,200,250,315,355,400];

  // --- PRODUTOS (template) ---
  const PRODUCTS = [
    {
      id: "romafaser_ct_plus_sdr9",
      name: "ROMAFASER CT +",
      ref: "PP‑RCT 125 + FG • SDR 9 • Ø32–Ø250 • 4 Stripes",
      chips: ["PP‑RCT 125","FG","SDR 9","Ø32–Ø250","4 Stripes"],
      avail: {32:"std",40:"std",50:"std",63:"std",75:"std",90:"std",110:"std",125:"dem",160:"dem",200:"dem",250:"dem"}
    },
    {
      id: "romafaser_ct_sdr11",
      name: "ROMAFASER CT",
      ref: "PP‑RCT 125 + FG • SDR 11 • Ø40–Ø250 • 4 Stripes",
      chips: ["PP‑RCT 125","FG","SDR 11","Ø40–Ø250","4 Stripes"],
      avail: {40:"std",50:"std",63:"std",75:"std",90:"std",110:"std",125:"std",160:"std",200:"std",250:"std"}
    },
    {
      id: "romaklima_ct_sdr17",
      name: "ROMAKLIMA CT",
      ref: "PP‑RCT 125 + FG • SDR 17 • Ø125–Ø400 • 4 Stripes",
      chips: ["PP‑RCT 125","FG","SDR 17","Ø125–Ø400","4 Stripes"],
      avail: {125:"std",160:"std",200:"std",250:"std",315:"dem",355:"dem",400:"dem"}
    },
    {
      id: "helisystem_sdr6",
      name: "HELISYSTEM",
      ref: "PP‑R 100 • SDR 6 • Ø20–Ø110 • 1 Stripe",
      chips: ["PP‑R 100","SDR 6","Ø20–Ø110","1 Stripe"],
      avail: {20:"std",25:"std",32:"std",40:"std",50:"std",63:"std",75:"std",90:"std",110:"std"}
    },
    {
      id: "helisystem_sdr74",
      name: "HELISYSTEM",
      ref: "PP‑R 100 • SDR 7,4 • Ø20–Ø110 • 1 Stripe",
      chips: ["PP‑R 100","SDR 7,4","Ø20–Ø110","1 Stripe"],
      avail: {20:"std",25:"std",32:"std",40:"std",50:"std",63:"std",75:"std",90:"std",110:"std",125:"dem",160:"dem"}
    },
    {
      id: "romafaser_fg_sdr74",
      name: "ROMAFASER",
      ref: "PP‑R 100 + FG • SDR 7,4 • Ø20–Ø110 • 4 Stripes",
      chips: ["PP‑R 100","FG","SDR 7,4","Ø20–Ø110","4 Stripes"],
      avail: {20:"std",25:"std",32:"std",40:"std",50:"std",63:"std",75:"std",90:"std",110:"std",125:"dem",160:"dem",200:"dem",250:"dem"}
    },
    {
      id: "romaklima_fg_sdr11",
      name: "ROMAKLIMA",
      ref: "PP‑R 100 + FG • SDR 11 • Ø32–Ø160 • 4 Stripes",
      chips: ["PP‑R 100","FG","SDR 11","Ø32–Ø160","4 Stripes"],
      avail: {32:"std",40:"std",50:"std",63:"std",75:"std",90:"std",110:"std",125:"dem",160:"dem"}
    },
    {
      id: "romafaser_antiuv",
      name: "ROMAFASER",
      ref: "Anti‑UV • PP‑R 100 + FG • SDR 7,4 • Ø20–Ø75",
      chips: ["Anti‑UV","PP‑R 100","FG","SDR 7,4","Ø20–Ø75"],
      avail: {20:"std",25:"std",32:"std",40:"std",50:"std",63:"std",75:"std"}
    }
  ];

  // Associações (data-seg do SVG -> product.id)
  const SEG_TO_PRODUCT = {
    "1":"romafaser_ct_plus_sdr9",
    "2":"romafaser_ct_sdr11",
    "3":"romaklima_ct_sdr17",
    "4":"helisystem_sdr6",
    "5":"helisystem_sdr74",
    "6":"romafaser_fg_sdr74",
    "7":"romaklima_fg_sdr11",
    "8":"romafaser_antiuv"
  };

  const svgHost = document.getElementById('svgHost');
  const mapWrap = document.getElementById('mapWrap');

  const callout = document.getElementById('callout');
  const callTitle = document.getElementById('callTitle');
  const callRef = document.getElementById('callRef');
  const callChips = document.getElementById('callChips');
  const callLine = document.getElementById('callLine');
  const callDot = document.getElementById('callDot');

  const selMeta = document.getElementById('selMeta');
  const selName = document.getElementById('selName');
  const selRef = document.getElementById('selRef');
  const diamHead = document.getElementById('diamHead');
  const diamBody = document.getElementById('diamBody');
  const clearBtn = document.getElementById('clearBtn');

  const C = {x:500,y:500};
  const R_OUT = 485; // baseado no viewBox 1000x1000

  let svgRoot = null;
  let pinned = null;
  let hoverPid = null;

  // --- Tabela (head fixo) ---
  function renderHead(){
    const tr = document.createElement('tr');
    const th0 = document.createElement('th');
    th0.textContent = "DIÂMETROS (mm)";
    tr.appendChild(th0);
    for(const d of DIAMS){
      const th = document.createElement('th');
      th.textContent = d;
      tr.appendChild(th);
    }
    diamHead.innerHTML = "";
    diamHead.appendChild(tr);
  }

  function sym(v){
    if(v === "std") return "✓";
    if(v === "dem") return "○";
    return "–";
  }

  function renderBody(prod){
    const tr = document.createElement('tr');
    const td0 = document.createElement('td');
    td0.textContent = prod ? prod.name : "—";
    tr.appendChild(td0);
    for(const d of DIAMS){
      const td = document.createElement('td');
      td.textContent = prod ? sym(prod.avail?.[d]) : "";
      tr.appendChild(td);
    }
    diamBody.innerHTML = "";
    diamBody.appendChild(tr);
  }

  renderHead();
  renderBody(null);

  // --- UI helpers ---
  function setActive(pid){
    if(!svgRoot) return;
    svgRoot.querySelectorAll('.seg[data-seg]').forEach(el => {
      const seg = el.getAttribute('data-seg');
      const p = SEG_TO_PRODUCT[seg];
      el.classList.toggle('active', !!pid && p === pid);
    });
  }

  function showCallout(prod, xPx, yPx){
    callTitle.textContent = prod.name;
    callRef.textContent = prod.ref;
    callChips.innerHTML = "";
    (prod.chips || []).forEach(t => {
      const s = document.createElement('span');
      s.className = 'chip';
      s.textContent = t;
      callChips.appendChild(s);
    });
    callout.style.left = xPx + "px";
    callout.style.top = yPx + "px";
    callout.classList.add('show');
  }

  function hideCallout(){
    callout.classList.remove('show');
    callLine.setAttribute("x1", 500); callLine.setAttribute("y1", 500);
    callLine.setAttribute("x2", 500); callLine.setAttribute("y2", 500);
    callDot.setAttribute("cx", 500); callDot.setAttribute("cy", 500);
  }

  function updateSelection(pid){
    if(!pid){
      selMeta.textContent = "Nenhum tubo selecionado";
      selName.textContent = "—";
      selRef.textContent = "Passe o mouse sobre um segmento para ver detalhes e a tabela de diâmetros.";
      renderBody(null);
      setActive(null);
      return;
    }
    const prod = PRODUCTS.find(p => p.id === pid);
    if(!prod) return;
    selMeta.textContent = "Selecionado";
    selName.textContent = prod.name;
    selRef.textContent = prod.ref;
    renderBody(prod);
    setActive(pid);
  }

  // --- Posicionamento da callout + linha (pixel-perfect relativo ao viewBox) ---
  function placeCallout(pid){
    const prod = PRODUCTS.find(p => p.id === pid);
    if(!prod || !svgRoot) return;

    // element -> bbox no sistema do SVG (viewBox 0..1000)
    const segEl = [...svgRoot.querySelectorAll('.seg[data-seg]')].find(el => SEG_TO_PRODUCT[el.getAttribute('data-seg')] === pid);
    const bb = segEl ? segEl.getBBox() : {x:480,y:120,width:40,height:40};
    const cx = bb.x + bb.width/2;
    const cy = bb.y + bb.height/2;

    // direção a partir do centro
    const dx = cx - C.x, dy = cy - C.y;
    const len = Math.max(1, Math.hypot(dx,dy));
    const ux = dx/len, uy = dy/len;

    const anchor = { x: C.x + ux*(R_OUT - 10), y: C.y + uy*(R_OUT - 10) };
    const out    = { x: C.x + ux*(R_OUT + 85), y: C.y + uy*(R_OUT + 85) };

    callLine.setAttribute("x1", anchor.x);
    callLine.setAttribute("y1", anchor.y);
    callLine.setAttribute("x2", out.x);
    callLine.setAttribute("y2", out.y);
    callDot.setAttribute("cx", anchor.x);
    callDot.setAttribute("cy", anchor.y);

    // converter coords do viewBox -> pixels no container
    const rect = mapWrap.getBoundingClientRect();
    const xPx = (out.x / 1000) * rect.width;
    const yPx = (out.y / 1000) * rect.height;

    showCallout(prod, xPx, yPx);
  }

  // --- Eventos ---
  function onHover(pid){
    hoverPid = pid;
    if(pinned) return;
    updateSelection(pid);
    placeCallout(pid);
  }
  function onLeave(pid){
    if(pinned) return;
    hoverPid = null;
    updateSelection(null);
    hideCallout();
  }
  function onClick(pid){
    if(pinned === pid){
      pinned = null;
      if(hoverPid){
        updateSelection(hoverPid);
        placeCallout(hoverPid);
      }else{
        updateSelection(null);
        hideCallout();
      }
      return;
    }
    pinned = pid;
    updateSelection(pid);
    placeCallout(pid);
  }

  clearBtn.addEventListener('click', () => {
    pinned = null;
    hoverPid = null;
    updateSelection(null);
    hideCallout();
  });

  // --- Loader do SVG (inline) ---
  async function loadSvg(paths){
    for (const p of paths){
      try{
        const res = await fetch(p, {cache:"no-store"});
        if(!res.ok) continue;
        const txt = await res.text();
        svgHost.innerHTML = txt;
        svgRoot = svgHost.querySelector('svg');
        if(!svgRoot) continue;
        // garantir que o SVG respeita o container
        svgRoot.removeAttribute('width');
        svgRoot.removeAttribute('height');
        svgRoot.setAttribute('preserveAspectRatio','xMidYMid meet');

        // anexar eventos por segmento
        svgRoot.querySelectorAll('.seg[data-seg]').forEach(el => {
          const seg = el.getAttribute('data-seg');
          const pid = SEG_TO_PRODUCT[seg];
          if(!pid) return;

          el.addEventListener('mouseenter', () => onHover(pid));
          el.addEventListener('mouseleave', () => onLeave(pid));
          el.addEventListener('click', (ev) => { ev.preventDefault(); onClick(pid); });

          // touch/mobile
          el.addEventListener('pointerdown', (ev) => {
            if(ev.pointerType === 'touch'){
              ev.preventDefault();
              onClick(pid);
            }
          }, {passive:false});

          // facilitar debug no DevTools
          el.dataset.pid = pid;
        });

        return true;
      }catch(e){
        // tenta próximo path
      }
    }
    return false;
  }

  // Tenta nomes comuns (ajuste se você renomeou no GitHub)
  loadSvg([
    "./mapa_produto_interativo.svg",
    "./mapa_produto_interativo_stripes_like_screenshot_fixed2.svg",
    "./technical_catalog_map_svg_interactive_stripes_like_screenshot_fixed2.svg"
  ]).then(ok => {
    if(!ok){
      svgHost.innerHTML = `<div style="padding:16px; color:#b91c1c; font-weight:800;">
        Não foi possível carregar o SVG. Confirme que o arquivo está no mesmo diretório e que o nome está correto.
      </div>`;
    }
  });

})();
</script>
</body>
</html>
