<!doctype html>
<html lang="pt" translate="no" class="notranslate">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="google" content="notranslate" />
  <title>Catálogo Técnico — PP-R Pipes</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --border:rgba(15,23,42,.12);
      --accent:#16a34a;
      --card:#ffffff;
      --shadow: 0 14px 40px rgba(0,0,0,.10);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; color:var(--text); background:var(--bg);}
    a{color:inherit; text-decoration:none}
    .container{width:min(1120px, calc(100% - 32px)); margin:0 auto;}

    .header{padding:22px 0 10px;}
    .kicker{color:var(--muted); font-weight:900; letter-spacing:.2px;}
    h1{margin:8px 0 0; font-size: clamp(22px, 3.2vw, 36px); line-height:1.06; font-weight:1000;}
    .lead{margin:10px 0 0; color:var(--muted); line-height:1.6;}

    .grid{display:grid; grid-template-columns: 1fr 360px; gap:14px; align-items:start; padding:14px 0 22px;}
    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow: var(--shadow);}
    .pad{padding:16px;}

    /* Catalog map */
    .mapWrap{position:relative; width:100%; aspect-ratio:1/1; max-width:820px; margin:0 auto;}
    .mapImg{width:100%; height:100%; display:block; border-radius:999px; user-select:none; -webkit-user-drag:none;}
    .overlaySvg{position:absolute; inset:0; width:100%; height:100%;}
    .seg{fill:transparent; cursor:pointer;}
    .seg:hover{stroke: rgba(22,163,74,.70); stroke-width:2;}
    .seg.active{stroke: rgba(22,163,74,.90); stroke-width:3;}

    /* Callout */
    .callout{position:absolute; min-width: 220px; max-width: 280px; background:#fff; border:1px solid var(--border); border-radius:16px; box-shadow: 0 18px 48px rgba(0,0,0,.16); padding:12px 12px; display:none;}
    .callout.show{display:block;}
    .callout .t{font-weight:1000; margin:0 0 6px; font-size:14px;}
    .callout .p{margin:0; color:var(--muted); font-weight:800; line-height:1.45; font-size:12px;}
    .callout .chips{display:flex; gap:6px; flex-wrap:wrap; margin-top:10px;}
    .chip{display:inline-flex; align-items:center; padding:6px 9px; border-radius:999px; border:1px solid var(--border); background:rgba(15,23,42,.03); color:var(--muted); font-weight:900; font-size:11px;}

    .callLine{position:absolute; inset:0; pointer-events:none;}
    .callLine line{stroke: rgba(15,23,42,.55); stroke-width:2;}
    .callLine circle{fill: rgba(15,23,42,.65);}

    /* Sidebar */
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:rgba(15,23,42,.03); color:var(--muted); font-weight:900; font-size:12px;}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:10px; padding:10px 12px; border-radius:14px; border:1px solid var(--border); background:rgba(15,23,42,.04); font-weight:950; cursor:pointer; min-height:44px;}
    .btn.primary{background:rgba(22,163,74,.14); border-color:rgba(22,163,74,.28);}
    .btn.primary:hover{background:rgba(22,163,74,.18);}

    /* Table */
    .tableWrap{overflow:auto; border-radius:16px; border:1px solid var(--border);}
    table{border-collapse:separate; border-spacing:0; width:100%; min-width:920px; background:#fff;}
    thead th{position:sticky; top:0; background:#f8fafc; z-index:1;}
    th, td{border-bottom:1px solid var(--border); border-right:1px solid var(--border); padding:10px 10px; text-align:center; font-weight:900; font-size:12px; white-space:nowrap;}
    th:first-child, td:first-child{text-align:left;}
    tr:last-child td{border-bottom:0;}
    th:last-child, td:last-child{border-right:0;}
    .rowTitle{font-weight:1000;}
    .legend{display:flex; gap:10px; flex-wrap:wrap; align-items:center; color:var(--muted); font-weight:850; font-size:12px; margin-top:10px;}
    .mark{display:inline-flex; align-items:center; justify-content:center; width:18px; height:18px; border-radius:999px; border:2px solid rgba(15,23,42,.65); font-size:12px; line-height:1;}
    .mark.std{border-color: rgba(15,23,42,.65);}
    .mark.dem{border-style:solid; border-color: rgba(15,23,42,.65);}
    .mark.empty{border-color: transparent;}
    .mark.std::before{content:"✓"; font-weight:1000;}
    .mark.dem{border-width:3px;}
    .mark.dem::before{content:"";}
    .mark.dem{background:transparent;}
    .mark.dem{box-shadow: inset 0 0 0 2px transparent;}
    .mark.dem{position:relative;}
    .mark.dem::after{content:""; position:absolute; inset:3px; border:2px solid rgba(15,23,42,.65); border-radius:999px;}
    .muted{color:var(--muted); font-weight:850; line-height:1.55;}

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
      table{min-width:860px;}
    }
  
    /* Embed mode (quando aberto dentro do technical_info) */
    body.embed .header{display:none;}
    body.embed .container{padding:12px; max-width:none;}
    body.embed .grid{grid-template-columns: 1fr;}
    body.embed .grid{gap:14px;}
    body.embed .card{border-radius:18px;}

  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="kicker">Catálogo Técnico • Interativo</div>
      <h1>Mapa de catálogo — Tubos PP‑R</h1>
      <p class="lead">Passe o mouse (ou toque no telemóvel) sobre cada setor para ver a referência e a disponibilidade de diâmetros.</p>
      <div style="margin-top:10px;"><span class="pill">Dica: clique para “fixar” a seleção</span></div>
    </div>

    <div class="grid">
      <section class="card">
        <div class="pad">
          <div class="mapWrap" id="mapWrap">
            <!-- Use a imagem recortada do círculo (sem legendas) -->
            <img class="mapImg" id="mapImg" src="./catalog_circle.png" alt="Mapa circular do catálogo" />

            <!-- SVG overlay para hover/seleção -->
            <svg class="overlaySvg" id="overlay" viewBox="0 0 1000 1000" aria-label="Mapa interativo" role="img"></svg>

            <!-- Linha e ponto do callout -->
            <svg class="callLine" id="callLine" viewBox="0 0 1000 1000" aria-hidden="true">
              <line id="callLineSeg" x1="0" y1="0" x2="0" y2="0"></line>
              <circle id="callDot" cx="0" cy="0" r="8"></circle>
            </svg>

            <!-- Callout (texto) -->
            <div class="callout" id="callout" aria-live="polite">
              <div class="t" id="callTitle">—</div>
              <div class="p" id="callText">—</div>
              <div class="chips" id="callChips"></div>
            </div>
          </div>
        </div>
      </section>

      <aside class="card">
        <div class="pad">
          <div class="kicker">Seleção</div>
          <div style="font-weight:1000; font-size:16px; margin-top:6px;" id="selName">Nenhum tubo selecionado</div>
          <p class="muted" style="margin:8px 0 12px;" id="selDesc">Passe o mouse sobre um setor para ver detalhes e a tabela de diâmetros.</p>

          <div class="tableWrap" style="margin-top:12px;">
            <table aria-label="Tabela de diâmetros" id="diamTable"></table>
          </div>

          <div class="legend">
            <span><span class="mark std"></span> Produto standard</span>
            <span><span class="mark dem"></span> Disponível sob encomenda</span>
          </div>

          <div style="margin-top:12px;">
            <button class="btn" id="clearBtn" type="button">Limpar seleção</button>
          </div>

          <div class="muted" style="margin-top:12px;">
            Nota: este é um template. Se você fornecer os dados finais (por linha e diâmetro), eu ajusto o dataset para ficar idêntico ao catálogo oficial.
          </div>
        </div>
      </aside>
    </div>
  </div>

<script>
(function(){
  const isEmbed = (location.hash || "").includes("embed") || (new URLSearchParams(location.search)).get("embed")==="1";
  if(isEmbed) document.body.classList.add("embed");
  // --- CONFIGURAÇÃO DO MAPA ---
  // Centro e raios no viewBox 1000x1000
  const C = { x: 500, y: 500 };
  const R_IN = 265;     // raio interno do “anel clicável”
  const R_OUT = 470;    // raio externo do “anel clicável”

  // Produtos (exemplos). Ajuste para refletir exatamente o catálogo.
  // start/end em graus (0 = direita, 90 = baixo, 180 = esquerda, 270 = cima) por convenção abaixo.
  const DIAMS = [20,25,32,40,50,63,75,90,110,125,160,200,250,315,355,400];

  const PRODUCTS = [
    {
      id: "romaklima_ct_sdr17",
      name: "ROMAKLIMA CT",
      ref: "PP‑RCT 125 + FG • SDR 17 • Ø125–Ø400 • 4 Stripes",
      chips: ["PP‑RCT", "FG", "SDR 17", "Ø125–Ø400", "4 Stripes"],
      // Disponibilidades (std/demand) por diâmetro
      avail: {125:"std",160:"std",200:"std",250:"std",315:"std",355:"std",400:"std"},
      // setor (aprox.)
      start: 300, end: 340,
      callPos: { side: "top" }
    },
    {
      id: "helisystem_sdr6",
      name: "HELISYSTEM",
      ref: "PP‑R 100 • SDR 6 • Ø20–Ø110 • 1 Stripe",
      chips: ["PP‑R 100", "SDR 6", "Ø20–Ø110", "1 Stripe"],
      avail: {20:"std",25:"std",32:"std",40:"std",50:"std",63:"std",75:"std",90:"std",110:"std"},
      start: 340, end: 30, // wrap
      callPos: { side: "right" }
    },
    {
      id: "helisystem_sdr74",
      name: "HELISYSTEM",
      ref: "PP‑R 100 • SDR 7,4 • Ø20–Ø110 • 1 Stripe",
      chips: ["PP‑R 100", "SDR 7,4", "Ø20–Ø110", "1 Stripe"],
      avail: {20:"std",25:"std",32:"std",40:"std",50:"std",63:"std",75:"std",90:"std",110:"std",125:"dem",160:"dem"},
      start: 30, end: 75,
      callPos: { side: "right" }
    },
    {
      id: "romafaser_fg_sdr74",
      name: "ROMAFASER",
      ref: "PP‑R 100 + FG • SDR 7,4 • Ø20–Ø250 • 4 Stripes",
      chips: ["PP‑R 100", "FG", "SDR 7,4", "Ø20–Ø250", "4 Stripes"],
      avail: {20:"std",25:"std",32:"std",40:"std",50:"std",63:"std",75:"std",90:"std",110:"std",125:"dem",160:"dem",200:"dem",250:"dem"},
      start: 75, end: 130,
      callPos: { side: "bottom" }
    },
    {
      id: "romaklima_fg_sdr11",
      name: "ROMAKLIMA",
      ref: "PP‑R 100 + FG • SDR 11 • Ø32–Ø160 • 4 Stripes",
      chips: ["PP‑R 100", "FG", "SDR 11", "Ø32–Ø160", "4 Stripes"],
      avail: {32:"std",40:"std",50:"std",63:"std",75:"std",90:"std",110:"std",125:"dem",160:"dem"},
      start: 130, end: 185,
      callPos: { side: "bottom" }
    },
    {
      id: "romafaser_ct_sdr11",
      name: "ROMAFASER CT",
      ref: "PP‑RCT 125 + FG • SDR 11 • Ø40–Ø250 • 4 Stripes",
      chips: ["PP‑RCT", "FG", "SDR 11", "Ø40–Ø250", "4 Stripes"],
      avail: {40:"std",50:"std",63:"std",75:"std",90:"std",110:"std",125:"std",160:"std",200:"std",250:"std",315:"dem",355:"dem",400:"dem"},
      start: 185, end: 245,
      callPos: { side: "left" }
    },
    {
      id: "romafaser_antiuv",
      name: "ROMAFASER Anti‑UV",
      ref: "PP‑R 100 + FG • SDR 7,4 • Ø20–Ø75 • Anti‑UV",
      chips: ["PP‑R 100", "FG", "SDR 7,4", "Anti‑UV", "Ø20–Ø75"],
      avail: {20:"std",25:"std",32:"std",40:"std",50:"std",63:"std",75:"std"},
      start: 245, end: 300,
      callPos: { side: "left" }
    }
  ];

  const overlay = document.getElementById("overlay");
  const callout = document.getElementById("callout");
  const callTitle = document.getElementById("callTitle");
  const callText = document.getElementById("callText");
  const callChips = document.getElementById("callChips");
  const selName = document.getElementById("selName");
  const selDesc = document.getElementById("selDesc");
  const diamTable = document.getElementById("diamTable");
  const clearBtn = document.getElementById("clearBtn");
  const mapWrap = document.getElementById("mapWrap");

  const line = document.getElementById("callLineSeg");
  const dot = document.getElementById("callDot");

  let pinnedId = null;

  function degToRad(deg){
    // 0° at right, clockwise; convert to radians in SVG coords where +y is down
    return (deg * Math.PI) / 180;
  }

  function polar(r, deg){
    const a = degToRad(deg);
    return { x: C.x + r*Math.cos(a), y: C.y + r*Math.sin(a) };
  }

  function arcPath(r, a0, a1){
    // returns SVG arc from a0 to a1 (degrees), clockwise
    // handle wrap
    const sweep = 1;
    let delta = a1 - a0;
    if (delta < 0) delta += 360;
    const large = delta > 180 ? 1 : 0;
    const p0 = polar(r, a0);
    const p1 = polar(r, a1);
    return `A ${r} ${r} 0 ${large} ${sweep} ${p1.x} ${p1.y}`;
  }

  function wedgePath(a0, a1){
    // if wrap, split into two wedges
    let delta = a1 - a0;
    if (delta < 0) delta += 360;

    const pIn0 = polar(R_IN, a0);
    const pOut0 = polar(R_OUT, a0);
    const pIn1 = polar(R_IN, a1);
    const pOut1 = polar(R_OUT, a1);

    // Path: inner arc -> line -> outer arc back -> close
    return [
      `M ${pIn0.x} ${pIn0.y}`,
      arcPath(R_IN, a0, a1),
      `L ${pOut1.x} ${pOut1.y}`,
      // outer arc reversed (counterclockwise)
      (() => {
        const sweep = 0;
        const large = delta > 180 ? 1 : 0;
        return `A ${R_OUT} ${R_OUT} 0 ${large} ${sweep} ${pOut0.x} ${pOut0.y}`;
      })(),
      `Z`
    ].join(" ");
  }

  function addSegment(prod){
    // handle wrap by creating 1 or 2 paths
    const segs = [];
    if (prod.end >= prod.start){
      segs.push({a0: prod.start, a1: prod.end});
    } else {
      segs.push({a0: prod.start, a1: 360});
      segs.push({a0: 0, a1: prod.end});
    }

    segs.forEach((s, idx) => {
      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", wedgePath(s.a0, s.a1));
      path.setAttribute("class", "seg");
      path.dataset.pid = prod.id;
      path.dataset.part = String(idx);
      path.addEventListener("mouseenter", () => onHover(prod.id));
      path.addEventListener("mouseleave", () => onLeave(prod.id));
      path.addEventListener("click", () => onClick(prod.id));
      overlay.appendChild(path);
    });
  }

  function setActive(pid){
    overlay.querySelectorAll(".seg").forEach(p => {
      p.classList.toggle("active", p.dataset.pid === pid);
    });
  }

  function placeCallout(pid){
    const prod = PRODUCTS.find(p => p.id === pid);
    if (!prod) return;

    // Use mid angle for anchor point (handle wrap)
    let mid = prod.start + ((prod.end - prod.start + 360) % 360) / 2;
    mid = (mid + 360) % 360;

    const anchor = polar(R_OUT - 8, mid);
    const out = polar(R_OUT + 75, mid);

    // Line inside SVG coords
    line.setAttribute("x1", anchor.x);
    line.setAttribute("y1", anchor.y);
    line.setAttribute("x2", out.x);
    line.setAttribute("y2", out.y);
    dot.setAttribute("cx", anchor.x);
    dot.setAttribute("cy", anchor.y);

    // Convert SVG coords to CSS pixels in the mapWrap box
    const rect = mapWrap.getBoundingClientRect();
    const px = (out.x/1000) * rect.width;
    const py = (out.y/1000) * rect.height;

    // Callout positioning: try to keep within viewport
    callout.classList.add("show");
    callTitle.textContent = prod.name;
    callText.textContent = prod.ref;

    callChips.innerHTML = "";
    (prod.chips || []).forEach(c => {
      const span = document.createElement("span");
      span.className = "chip";
      span.textContent = c;
      callChips.appendChild(span);
    });

    // Default placement with slight offset
    const pad = 10;
    const w = callout.offsetWidth || 260;
    const h = callout.offsetHeight || 120;

    let left = px + 10;
    let top = py - h/2;

    // If on right side, open to left
    if (px > rect.width*0.55) left = px - w - 12;
    // Clamp
    left = Math.max(pad, Math.min(left, rect.width - w - pad));
    top = Math.max(pad, Math.min(top, rect.height - h - pad));

    callout.style.left = left + "px";
    callout.style.top = top + "px";
  }

  function hideCallout(){
    callout.classList.remove("show");
    line.setAttribute("x1", 0); line.setAttribute("y1", 0);
    line.setAttribute("x2", 0); line.setAttribute("y2", 0);
    dot.setAttribute("cx", 0); dot.setAttribute("cy", 0);
  }

  function renderTable(pid){
    const prod = PRODUCTS.find(p => p.id === pid);
    if (!prod){
      diamTable.innerHTML = `
        <thead><tr><th>Tipo</th>${DIAMS.map(d => `<th>${d}</th>`).join("")}</tr></thead>
        <tbody><tr><td class="rowTitle">—</td>${DIAMS.map(_ => `<td><span class="mark empty"></span></td>`).join("")}</tr></tbody>
      `;
      return;
    }

    const header = `<thead><tr><th>DIÂMETROS (mm)</th>${DIAMS.map(d => `<th>${d}</th>`).join("")}</tr></thead>`;
    const row = `<tr>
      <td class="rowTitle">${prod.name}</td>
      ${DIAMS.map(d => {
        const k = String(d);
        const v = prod.avail && prod.avail[k];
        if (v === "std") return `<td><span class="mark std" title="Standard"></span></td>`;
        if (v === "dem") return `<td><span class="mark dem" title="Sob encomenda"></span></td>`;
        return `<td><span class="mark empty"></span></td>`;
      }).join("")}
    </tr>`;

    diamTable.innerHTML = header + `<tbody>${row}</tbody>`;
  }

  function setSidebar(pid){
    const prod = PRODUCTS.find(p => p.id === pid);
    if (!prod){
      selName.textContent = "Nenhum tubo selecionado";
      selDesc.textContent = "Passe o mouse sobre um setor para ver detalhes e a tabela de diâmetros.";
      renderTable(null);
      return;
    }
    selName.textContent = prod.name;
    selDesc.textContent = prod.ref;
    renderTable(pid);
  }

  function onHover(pid){
    if (pinnedId && pinnedId !== pid) return; // if pinned, ignore other hovers
    setActive(pid);
    placeCallout(pid);
    setSidebar(pid);
  }

  function onLeave(pid){
    if (pinnedId) return; // keep
    setActive(null);
    hideCallout();
    setSidebar(null);
  }

  function onClick(pid){
    if (pinnedId === pid){
      pinnedId = null;
      setActive(null);
      hideCallout();
      setSidebar(null);
      return;
    }
    pinnedId = pid;
    setActive(pid);
    placeCallout(pid);
    setSidebar(pid);
  }

  clearBtn.addEventListener("click", () => {
    pinnedId = null;
    setActive(null);
    hideCallout();
    setSidebar(null);
  });

  // Build segments
  PRODUCTS.forEach(addSegment);

  // Initial empty table
  renderTable(null);

  // Reposition callout on resize (if visible)
  window.addEventListener("resize", () => {
    if (callout.classList.contains("show") && pinnedId) placeCallout(pinnedId);
  });

})();
</script>
</body>
</html>
